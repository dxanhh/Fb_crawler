if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }

__d("MPrivacySelector",["$","CSS","DOM","MLegacyDataStore","MModalDialog","MRequest","Stratcom","XPrivacyCustomEditController","createDeprecatedProperties","eventsMixinDeprecated"],(function(a,b,c,d,e,f){var g="structured_composer";a=function(){"use strict";function a(a,c){var d=this;this.setSelector(b("$")(a));this._dialogID=c||g;a=b("MLegacyDataStore").get(this.getSelector());this._updateURI=a.update_uri;this._rowClickListener=b("DOM").listen(this.getSelector(),"click","composer-privacy-row",this._handleRowClick.bind(this));b("Stratcom").listen("MMentions:change",null,function(a){if(!b("Stratcom").hasSigil(a.getData().input,"composer-textarea"))return;d._mentionsHasTags=a.getData().hasTags;d.setTagExpansion()})}var c=a.prototype;c.removeListeners=function(){this._clickListener&&(this._clickListener.remove(),this._clickListener=null),this._rowClickListener&&(this._rowClickListener.remove(),this._rowClickListener=null)};c.closePrivacy=function(){this.getIsOpen()&&(b("CSS").conditionClass(this.getSelector(),"showPrivacy",!1),this.setIsOpen(!1))};c.openPrivacy=function(){this.getIsOpen()||(b("CSS").conditionClass(this.getSelector(),"showPrivacy",!0),this.setIsOpen(!0))};c.toggleShow=function(a){this._photoAlbumChosen||(this.setIsOpen(!this.getIsOpen()),b("CSS").conditionClass(this.getSelector(),"showPrivacy",this.getIsOpen()))};c.setButton=function(a,c){this._button=b("$")(a),this._clickListener=b("DOM").listen(this._button,"click",null,this.toggleShow.bind(this)),c&&this.toggleShow()};c.setPrivacyFBID=function(a){this._privacyFBID=a};c.getPrivacyType=function(){this._updateCheckedRow();return b("MLegacyDataStore").get(this._checkedRow).type};c.getPrivRow=function(){this._updateCheckedRow();return b("MLegacyDataStore").get(this._checkedRow).priv_row.value};c.setCloseOnSelect=function(a){this._closeOnSelect=a};c.setPrivRow=function(a){var c=b("DOM").scry(this.getSelector(),"tr","composer-privacy-row");for(var d=0;d<c.length;++d)if(b("MLegacyDataStore").get(c[d]).priv_row.value===a){this._selectRow(c[d]);return!0}return!1};c.setTaggerHasTags=function(a){this._taggerHasTags=a,this.setTagExpansion()};c.setTagExpansion=function(){b("CSS").conditionClass(this.getSelector(),"showTagExpansion",this._mentionsHasTags||this._taggerHasTags),this._setButtonTagExpansion()};c.getPrivacyText=function(){this._updateCheckedRow();var a=b("DOM").find(this._checkedRow,"td","privacy-label");return a.innerText||a.textContent};c.getPrivacyImage=function(){this._updateCheckedRow();return b("DOM").find(this._checkedRow,"*","selector-image")};c._setButtonTagExpansion=function(){this._updateCheckedRow();var a=this.getSelector().className.indexOf("showTagExpansion")>-1&&b("DOM").scry(this._checkedRow,"span","plus-label").length!==0;this._button&&b("CSS").conditionClass(this._button,"showTagExpansion",a)};c._handleRowClick=function(a){a=a.getNode("composer-privacy-row");var c=b("MLegacyDataStore").get(a);c["custom-row"]?this._handleCustomRowClick(a,c):this._selectRow(a)};c._handleCustomRowClick=function(a,c){var d=this;b("DOM").hide(b("$")(this._dialogID));b("MModalDialog").open(b("XPrivacyCustomEditController").getURIBuilder().getURI(),function(c){b("DOM").hide(b("$")("viewport"));b("DOM").show(b("$")(d._dialogID));if(c.canceled)return;var e=b("DOM").find(a,"td","privacy-label");b("DOM").setContent(e,c.payload.label);b("MLegacyDataStore").set(a,{priv_row:c.payload.row});d._selectRow(a)})};c._selectRow=function(a){var c=b("MLegacyDataStore").get(a),d=b("DOM").find(this.getSelector(),"tr","privacy_input");this.invoke("choose",c);b("DOM").setContent(d,null);if(c.priv_row){for(var e in c.priv_row){var f;if(Array.isArray(c.priv_row[e]))for(var g=0;g<c.priv_row[e].length;g++)f="privacy_data["+e+"]["+g+"]",b("DOM").appendContent(d,b("DOM").create("input",{type:"hidden",name:f,value:c.priv_row[e][g]}));else if(e=="tdata")for(var h in c.priv_row[e])f="privacy_data["+e+"]["+h+"]",b("DOM").appendContent(d,b("DOM").create("input",{type:"hidden",name:f,value:c.priv_row[e][h]}));else this._privacyFBID?f="privacy_data["+this._privacyFBID+"]["+e+"]":(f="privacy_data["+e+"]",b("DOM").appendContent(d,b("DOM").create("input",{type:"hidden",name:f,value:c.priv_row[e]})))}!this._photoAlbumChosen&&this._updateURI&&!c["custom-row"]&&new(b("MRequest"))(this._updateURI).setData(c.priv_row).send()}if(this._button){h=b("DOM").scry(this._button,"*","privacy-button");for(g=0,f=h.length;g<f;g++)b("DOM").hide(h[g]);b("DOM").show(b("DOM").find(this._button,"*","priv-"+c.type))}this._photoAlbumChosen||(this._updateCheckedRow(),b("CSS").conditionClass(this._checkedRow,"checked",!1),this._checkedRow=a,b("CSS").conditionClass(this._checkedRow,"checked",!0));this._setButtonTagExpansion();this._closeOnSelect&&this.closePrivacy();b("Stratcom").invoke("MPrivacySelector::change",this.getSelector().id,c.priv_row)};c._updateCheckedRow=function(){this._checkedRow||(this._checkedRow=b("DOM").find(this.getSelector(),"tr","checked"))};return a}();b("eventsMixinDeprecated")(a,["choose"]);b("createDeprecatedProperties")(a,{isOpen:!1,selector:null});Object.assign(a.prototype,{_button:null,_checkedRow:null,_clickListener:null,_closeOnSelect:!1,_updateURI:null,_privacyFBID:null,_asyncData:null,_asyncListener:null,_rowClickListener:null,_mentionsHasTags:!1,_taggerHasTags:!1,_photoAlbumChosen:!1});e.exports=a}),null);
__d("MTimelineMedleyConstants",[],(function(a,b,c,d,e,f){a={ADD_TO_COLLECTION_FORM:"m-timeline-collections-add-to-collection-form",ADD_TO_COLLECTION_BUTTON:"m-timeline-collections-add-to-collection-button",COLLECTION_ADD_BUTTON:"m-timeline-collections-add-button",EDIT_PRIVACY_BUTTON:"m-timeline-collection-edit-privacy-button",PRIVACY_SELECTOR:"m-timeline-collection-privacy-selector",PRIVACY_DIALOG_CANCEL_BUTTON:"m-timeline-collection-privacy-cancel",PRIVACY_DIALOG_DONE_BUTTON:"m-timeline-collection-privacy-done",SUGGESTIONS_PRIVACY_SELECTOR:"m-timeline-collections-suggestions-privacy-selector",SUGGESTIONS_GRID_COLLECTION_TOKEN:"m-timeline-collections-suggestions-grid-collection-token",SUGGESTIONS_PRIVACY_ICON:"m-timeline-collections-suggestions-privacy-icon",COLLECTION_SUGGESTIONS:"m-timeline-collections-suggestions",COLLECTION_SUGGESTIONS_ITEM:"m-timeline-collections-item",COLLECTION_ITEM_PICTURE:"m-timeline-collections-item-picture",COLLECTION_ITEM_TITLE:"m-timeline-collections-item-title",COLLECTION_ITEM_SUBTITLE:"m-timeline-collections-item-subtitle"};b={COLLECTION_ADDED_BUTTON:"m-timeline-collections-added-button",PRIVACY_DIALOG:"m-timeline-collections-privacy-dialog",PRIVACY_ICONS:"m-timeline-collections-privacy-icons",SUGGESTION_ITEM_TEMPLATE:"m-timeline-collection-suggestion-template-id",TYPEAHEAD_HIDDEN_INPUT:"m-timeline-collection-typeahead-hidden-input"};f.Sigils=a;f.Ids=b}),66);
__d("MTimelinePrivacySelector",["$","DOM","MModalDialog","MPrivacySelector","MRequest","MTimelineMedleyConstants","MViewport","Stratcom","findTag"],(function(a,b,c,d,e,f,g){var h=!1,i=null,j=null,k=null,l=null,m=null,n=null;function o(a){if(l===null)return;a=d("DOM").find(l.getSelector(),"*","privacy_input");s(d("DOM").convertFormToDictionary(d("DOM").create("form",a.cloneNode(!0))));q();c("Stratcom").invoke(t,null,{privacy_type:l.getPrivacyType()})}function p(a){if(l===null)return;l.setPrivRow(n);q();c("Stratcom").invoke(u)}function q(){d("DOM").hide(k),d("DOM").show(c("$")("page"))}function r(a){if(a.canceled){c("Stratcom").invoke(u);return}s(a.privacy_data);c("Stratcom").invoke(t,null,{privacy_type:a.privacy_type})}function s(a){m=a,new(c("MRequest"))(j).setData(a).send()}var t="privacy-dialog-done",u="privacy-dialog-cancel";function a(a){if(h)return;h=!0;i=a.modal_dialog_uri;j=a.save_privacy_uri;m=a.privacy_row;if(i)return;a=c("$")(d("MTimelineMedleyConstants").Ids.PRIVACY_DIALOG);k=a.cloneNode(!0);k.id="";d("DOM").remove(a);d("DOM").appendContent(c("$")("viewport"),k);a=d("DOM").find(k,"*",d("MTimelineMedleyConstants").Sigils.PRIVACY_SELECTOR);l=new(c("MPrivacySelector"))(d("DOM").uniqID(a),d("DOM").uniqID(k));c("Stratcom").listen("click",d("MTimelineMedleyConstants").Sigils.PRIVACY_DIALOG_DONE_BUTTON,o);c("Stratcom").listen("click",d("MTimelineMedleyConstants").Sigils.PRIVACY_DIALOG_CANCEL_BUTTON,p)}function b(){if(i)d("MModalDialog").open(i,r);else{d("DOM").hide(c("$")("page"));var a=c("findTag")("viewport");a.style.minHeight="0";n=l!==null&&l.getPrivRow();d("DOM").show(k);k instanceof HTMLElement&&d("MViewport").scrollToNode(k)}}function e(){return m}g.PRIVACY_DIALOG_DONE=t;g.PRIVACY_DIALOG_CANCEL=u;g.init=a;g.open=b;g.getSelectedPrivacyData=e}),98);
__d("MTimelineCollectionsAddButton",["fbt","$","CSS","DOM","MLegacyDataStore","MParent","MRequest","MTimelineMedleyConstants","MTimelinePrivacySelector","Popover","Stratcom","findTag","nullthrows"],(function(a,b,c,d,e,f,g){var h=null,i=null;function j(a){a=b("findTag")(b("MLegacyDataStore").get(a.getTarget()).form_id,"form");var c=b("DOM").convertFormToDictionary(a),d=b("MTimelinePrivacySelector").getSelectedPrivacyData();Object.assign(c,d);new(b("MRequest"))(a.action).setData(c).send()}function k(a){a=a.getNode("popover");return b("$")(q._instances[a.id])}function l(a,c){j(a);var d=k(a),e=b("$")(b("MTimelineMedleyConstants").Ids.COLLECTION_ADDED_BUTTON).cloneNode(!0);b("DOM").show(e);b("DOM").replace(d,e);e.id=d.id;if(!c.updateCollectionItem)return;e=b("MParent").bySigil(d,b("MTimelineMedleyConstants").Sigils.COLLECTION_SUGGESTIONS_ITEM);e&&b("CSS").conditionClass(e,"aclb",!0);c=e&&b("DOM").find(e,"*",b("MTimelineMedleyConstants").Sigils.COLLECTION_ITEM_SUBTITLE);if(c){d=b("MLegacyDataStore").get(a.getTarget()).name;e=g._(/*FBT_CALL*/"Added to {collection_name}"/*FBT_CALL*/,[g._param("collection_name",d)]);b("DOM").setContent(c,e)}}function m(a){a.kill(),i=b("MLegacyDataStore").get(a.getTarget()).flyout_id,b("MTimelinePrivacySelector").open()}function n(a){var c=b("DOM").find(b("$")(b("MTimelineMedleyConstants").Ids.PRIVACY_ICONS),"*",a);a=b("DOM").scry(b("$")("root"),"*",b("MTimelineMedleyConstants").Sigils.EDIT_PRIVACY_BUTTON);a.forEach(function(a){a=b("DOM").scry(a,"i","")[0]||b("DOM").scry(a,"img","")[0];b("DOM").replace(a,c.cloneNode(!0))})}function o(a){n(a.getData().privacy_type),p()}function p(){var a=b("Popover").getInstance(b("nullthrows")(i));a.close();a.open()}var q={_instances:{},init:function(a,c,d){q._instances[c]=a;if(h)return;h=b("Stratcom").listen("click",b("MTimelineMedleyConstants").Sigils.ADD_TO_COLLECTION_BUTTON,function(a){l(a,d)});b("Stratcom").listen("click",b("MTimelineMedleyConstants").Sigils.EDIT_PRIVACY_BUTTON,m);b("Stratcom").listen(b("MTimelinePrivacySelector").PRIVACY_DIALOG_CANCEL,null,p);b("Stratcom").listen(b("MTimelinePrivacySelector").PRIVACY_DIALOG_DONE,null,o)}};e.exports=q}),null);